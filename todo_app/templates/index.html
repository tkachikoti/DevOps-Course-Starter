{% extends "layout.html" %}
{% block title %}To-Do App{% endblock %}

{% block content %}
  <div class="jumbotron">
    <h1 class="display-4">To-Do App - Home</h1>
    <p class="lead">Just another to-do app.</p>
  </div>

  <div class="row justify-content-center">
    <div class="col-auto">
        {% if list_of_items %}
          <h2 class="text-center my-5">Status Table</h2>
          <p>
            <button type="button" class="btn btn-primary" onclick="create_ticket_button()">Create Item</button>
            <button class="btn btn-outline-secondary" type="button" data-toggle="collapse" data-target="#collapseSortOptions" aria-expanded="false" aria-controls="collapseSortOptions">Sorting Options</button>
          </p>
          <div class="collapse" id="collapseSortOptions">
            <div class="card card-body">
                <form action="/" method="get">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label for="sortByInput1" class="form-label">Sort Status Table By</label>
                            <select name="sort_by" class="form-select" aria-label="Sort Status Table By" id="sortByInput1" value="{{ sort_options.sort_by }}">
                                <option {% if sort_options.sort_by=='title' %}selected{% endif %} value="title" label="Title"></option>
                                <option {% if sort_options.sort_by=='status' %}selected{% endif %} value="status" label="Status"></option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="orderByDescendingInput1" class="form-label">Display Order</label>
                            <select name="order_by_descending" class="form-select" aria-label="Display Order" id="orderByDescendingInput1" value="{{ sort_options.order_by_descending }}">
                                <option {% if sort_options.order_by_descending=='0' %}selected{% endif %} value="0" label="Ascending"></option>
                                <option {% if sort_options.order_by_descending=='1' %}selected{% endif %} value="1" label="Descending"></option>
                            </select>
                        </div>
                    </div>
                    <div class="d-grid gap-2 col-6 mx-auto my-5">
                        <button type="submit" class="btn btn-primary btn-lg">SORT TABLE</button>
                    </div>
                </form>
            </div>
          </div>
          <table class="table table-responsive table-hover shadow p-3 mb-5 bg-body rounded">
              <thead>
                  <tr>
                      <th scope="col">Title</th>
                      <th scope="col">Status</th>
                      <th scope="col">Due Date</th>
                      <th scope="col">Actions</th>
                  </tr>
              </thead>
              <tbody>
                  {% for item in list_of_items %}
                    <tr {% if item.is_complete() %}class="table-success"{% endif %}>
                      <th scope="row">{{ item.get_title() }}</th>
                      <td class="wrap-table-text">{{ item.get_status() }}</td>
                      <td class="wrap-table-text">{{ item.get_due_date() }}</td>
                      <td>
                        <div class="dropdown">
                          <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton1" data-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Open Action Menu</button>
                          <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
                            {% if item.is_complete() %}
                              <li><a class="dropdown-item" href="{{ url_for('mark_todo_item_not_started', id=item.id) }}">Mark as 'Not Started'</a></li>
                            {% else %}
                              <li><a class="dropdown-item" href="{{ url_for('mark_todo_item_complete', id=item.id) }}">Mark as 'Complete'</a></li>
                            {% endif %}
                            <li><a class="dropdown-item" href="{{ url_for('delete_todo_item', id=item.get_id()) }}" onclick="confirm_deletion(event)">Delete Item</a></li>
                          </ul>
                        </div>
                      </td>
                    </tr>
                  {% endfor %}
              </tbody>
          </table>
        {% else %}
          <div class="shadow p-3 mb-5 bg-body rounded justify-content-center text-center my-5">
              <h2 class="mb 3">No items found</h2>
              <button type="button" class="btn btn-primary btn-lg" onclick="create_ticket_button()">CREATE TICKET</button>
          </div>
        {% endif %}
    </div>
  </div>
{% endblock %}

{% block scripts %}
  <script>
    function confirm_deletion(event) {
      if (!window.confirm("Do you really want to delete this item?")) {
        event.preventDefault();
      }
    }
    function create_ticket_button() {
      window.location.href = "{{ url_for('add_todo_item') }}";
    }
  </script>
{% endblock %}